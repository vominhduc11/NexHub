server:
  port: ${SERVER_PORT}

eureka:
  instance:
    hostname: ${EUREKA_INSTANCE_HOSTNAME}
    prefer-ip-address: ${EUREKA_INSTANCE_PREFER_IP}
  client:
    register-with-eureka: ${EUREKA_CLIENT_REGISTER_WITH_EUREKA}
    fetch-registry: ${EUREKA_CLIENT_FETCH_REGISTRY}
    service-url:
      defaultZone: ${EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE}
  server:
    enable-self-preservation: ${EUREKA_SERVER_ENABLE_SELF_PRESERVATION}
    eviction-interval-timer-in-ms: ${EUREKA_SERVER_EVICTION_INTERVAL}

spring:
  cloud:
    gateway:
      routes:
        # Tổng hợp Swagger UI cho tất cả services - dùng auth-service làm host chính
        - id: gateway-swagger-ui-main
          uri: ${AUTH_SERVICE_URI}
          order: 50
          predicates:
            - Path=/swagger-ui.html
          filters:
            - SetPath=/swagger-ui.html
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: gateway-swagger-ui-resources
          uri: ${AUTH_SERVICE_URI}
          order: 50
          predicates:
            - Path=/swagger-ui/**
          filters:
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: gateway-swagger-webjars
          uri: ${AUTH_SERVICE_URI}
          order: 50
          predicates:
            - Path=/webjars/swagger-ui/**
          filters:
            - AddRequestHeader=X-Gateway-Request, true

        - id: auth-service-swagger-ui
          uri: ${AUTH_SERVICE_URI}
          predicates:
            - Path=/api/auth/swagger-ui.html
          filters:
            - SetPath=/swagger-ui.html
            - AddRequestHeader=X-Gateway-Request, true
          metadata:
            response-timeout: 30000
            connect-timeout: 20000
          order: 100
            
        - id: auth-service-swagger-resources
          uri: ${AUTH_SERVICE_URI}
          predicates:
            - Path=/api/auth/swagger-ui/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
          order: 100
            
        - id: auth-service-webjars
          uri: ${AUTH_SERVICE_URI}
          predicates:
            - Path=/api/auth/webjars/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
          order: 100
            
        - id: auth-service-api-docs
          uri: ${AUTH_SERVICE_URI}
          predicates:
            - Path=/api/auth/v3/api-docs/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
          order: 100
            
        # JWKS endpoint for JWT token validation
        - id: auth-service-jwks
          uri: ${AUTH_SERVICE_URI}
          predicates:
            - Path=/auth/.well-known/jwks.json
          filters:
            - AddRequestHeader=X-Gateway-Request, true
          order: 50
            
        - id: user-service-swagger-ui
          uri: ${USER_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/user/swagger-ui.html
          filters:
            - SetPath=/swagger-ui.html
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: user-service-swagger-resources
          uri: ${USER_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/user/swagger-ui/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: user-service-webjars
          uri: ${USER_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/user/webjars/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: user-service-api-docs
          uri: ${USER_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/user/v3/api-docs/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: notification-service-swagger-ui
          uri: ${NOTIFICATION_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/notification/swagger-ui.html
          filters:
            - SetPath=/swagger-ui.html
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: notification-service-swagger-resources
          uri: ${NOTIFICATION_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/notification/swagger-ui/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: notification-service-webjars
          uri: ${NOTIFICATION_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/notification/webjars/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: notification-service-api-docs
          uri: ${NOTIFICATION_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/notification/v3/api-docs/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: warranty-service-swagger-ui
          uri: ${WARRANTY_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/warranty/swagger-ui.html
          filters:
            - SetPath=/swagger-ui.html
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: warranty-service-swagger-resources
          uri: ${WARRANTY_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/warranty/swagger-ui/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: warranty-service-webjars
          uri: ${WARRANTY_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/warranty/webjars/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: warranty-service-api-docs
          uri: ${WARRANTY_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/warranty/v3/api-docs/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: blog-service-swagger-ui
          uri: ${BLOG_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/blog/swagger-ui.html
          filters:
            - SetPath=/swagger-ui.html
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: blog-service-swagger-resources
          uri: ${BLOG_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/blog/swagger-ui/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: blog-service-webjars
          uri: ${BLOG_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/blog/webjars/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: blog-service-api-docs
          uri: ${BLOG_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/blog/v3/api-docs/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: product-service-swagger-ui
          uri: ${PRODUCT_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/product/swagger-ui.html
          filters:
            - SetPath=/swagger-ui.html
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: product-service-swagger-resources
          uri: ${PRODUCT_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/product/swagger-ui/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: product-service-webjars
          uri: ${PRODUCT_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/product/webjars/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: product-service-api-docs
          uri: ${PRODUCT_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/product/v3/api-docs/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: language-service-swagger-ui
          uri: ${LANGUAGE_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/language/swagger-ui.html
          filters:
            - SetPath=/swagger-ui.html
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: language-service-swagger-resources
          uri: ${LANGUAGE_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/language/swagger-ui/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: language-service-webjars
          uri: ${LANGUAGE_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/language/webjars/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: language-service-api-docs
          uri: ${LANGUAGE_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/language/v3/api-docs/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: auth-service-direct
          uri: ${AUTH_SERVICE_URI}
          predicates:
            - Path=/auth/**
          filters:
            - StripPrefix=1
            - AddRequestHeader=X-Gateway-Request, true
          order: 200
            
        - id: auth-service
          uri: ${AUTH_SERVICE_URI}
          predicates:
            - Path=/api/auth/**
          filters:
            - StripPrefix=1
            - AddRequestHeader=X-Gateway-Request, true
          order: 200

        - id: user-service
          uri: ${USER_SERVICE_URI}
          order: 200
          predicates:
            - Path=/api/user/**
          filters:
            - StripPrefix=1
            - AddRequestHeader=X-Gateway-Request, true

        - id: notification-service
          uri: ${NOTIFICATION_SERVICE_URI}
          order: 200
          predicates:
            - Path=/api/notification/**
          filters:
            - StripPrefix=1
            - AddRequestHeader=X-Gateway-Request, true

        - id: blog-service
          uri: ${BLOG_SERVICE_URI}
          order: 200
          predicates:
            - Path=/api/blog/**
          filters:
            - StripPrefix=1
            - AddRequestHeader=X-Gateway-Request, true

        - id: warranty-service
          uri: ${WARRANTY_SERVICE_URI}
          order: 200
          predicates:
            - Path=/api/warranty/**
          filters:
            - StripPrefix=1
            - AddRequestHeader=X-Gateway-Request, true

        - id: product-service
          uri: ${PRODUCT_SERVICE_URI}
          order: 200
          predicates:
            - Path=/api/product/**
          filters:
            - StripPrefix=1
            - AddRequestHeader=X-Gateway-Request, true

        - id: language-service
          uri: ${LANGUAGE_SERVICE_URI}
          order: 200
          predicates:
            - Path=/api/language/**
          filters:
            - StripPrefix=1
            - AddRequestHeader=X-Gateway-Request, true

      globals:
        corsConfigurations:
          '[/**]':
            allowedOrigins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:8080,http://localhost:5731}
            allowedMethods: ${CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,OPTIONS}
            allowedHeaders: ${CORS_ALLOWED_HEADERS:Content-Type,Authorization,X-Requested-With,Accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers}
            allowCredentials: ${CORS_ALLOW_CREDENTIALS:true}

springdoc:
  swagger-ui:
    enabled: ${SWAGGER_UI_ENABLED:true}
    path: /swagger-ui.html
    config-url: /v3/api-docs/swagger-config
    urls:
      - url: /api/auth/v3/api-docs
        name: auth-service
        display-name: "🔐 Authentication Service"
      - url: /api/user/v3/api-docs
        name: user-service
        display-name: "👤 User Management Service"
      - url: /api/blog/v3/api-docs
        name: blog-service
        display-name: "📝 Blog Service"
      - url: /api/product/v3/api-docs
        name: product-service
        display-name: "🛍️ Product Service"
      - url: /api/language/v3/api-docs
        name: language-service
        display-name: "🌐 Language Service"
      - url: /api/notification/v3/api-docs
        name: notification-service
        display-name: "📬 Notification Service"
      - url: /api/warranty/v3/api-docs
        name: warranty-service
        display-name: "🛡️ Warranty Service"
  api-docs:
    enabled: ${SWAGGER_API_DOCS_ENABLED:true}
