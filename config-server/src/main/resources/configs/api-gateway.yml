server:
  port: ${SERVER_PORT}

eureka:
  instance:
    hostname: ${EUREKA_INSTANCE_HOSTNAME}
    prefer-ip-address: ${EUREKA_INSTANCE_PREFER_IP}
  client:
    register-with-eureka: ${EUREKA_CLIENT_REGISTER_WITH_EUREKA}
    fetch-registry: ${EUREKA_CLIENT_FETCH_REGISTRY}
    service-url:
      defaultZone: ${EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE}
  server:
    enable-self-preservation: ${EUREKA_SERVER_ENABLE_SELF_PRESERVATION}
    eviction-interval-timer-in-ms: ${EUREKA_SERVER_EVICTION_INTERVAL}

spring:
  cloud:
    gateway:
      routes:
        # ===================================================================================
        # MAIN SWAGGER UI HUB - Order 50 (High Priority)
        # Central Swagger documentation hosted by auth-service
        # Accessible at: http://localhost:8080/swagger-ui.html
        # ===================================================================================
        - id: gateway-swagger-ui-main
          uri: ${AUTH_SERVICE_URI}
          order: 50
          predicates:
            - Path=/swagger-ui.html
          filters:
            - SetPath=/swagger-ui.html
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: gateway-swagger-ui-resources
          uri: ${AUTH_SERVICE_URI}
          order: 50
          predicates:
            - Path=/swagger-ui/**
          filters:
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: gateway-swagger-webjars
          uri: ${AUTH_SERVICE_URI}
          order: 50
          predicates:
            - Path=/webjars/swagger-ui/**
          filters:
            - AddRequestHeader=X-Gateway-Request, true

        # ===================================================================================
        # AUTH-SERVICE SWAGGER ENDPOINTS - Order 100
        # Individual Swagger documentation for Authentication Service
        # Accessible at: http://localhost:8080/api/auth/swagger-ui.html
        # ===================================================================================
        - id: auth-service-swagger-ui
          uri: ${AUTH_SERVICE_URI}
          predicates:
            - Path=/api/auth/swagger-ui.html
          filters:
            - SetPath=/swagger-ui.html
            - AddRequestHeader=X-Gateway-Request, true
          metadata:
            response-timeout: 30000
            connect-timeout: 20000
          order: 100
            
        - id: auth-service-swagger-resources
          uri: ${AUTH_SERVICE_URI}
          predicates:
            - Path=/api/auth/swagger-ui/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
          order: 100
            
        - id: auth-service-webjars
          uri: ${AUTH_SERVICE_URI}
          predicates:
            - Path=/api/auth/webjars/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
          order: 100
            
        - id: auth-service-api-docs
          uri: ${AUTH_SERVICE_URI}
          predicates:
            - Path=/api/auth/v3/api-docs/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
          order: 100
            
        # ===================================================================================
        # SECURITY & JWT ENDPOINTS - Order 50 (High Priority)
        # JWKS endpoint for JWT public key distribution (required for token validation)
        # Accessible at: http://localhost:8080/auth/.well-known/jwks.json
        # ===================================================================================
        - id: auth-service-jwks
          uri: ${AUTH_SERVICE_URI}
          predicates:
            - Path=/auth/.well-known/jwks.json
          filters:
            - AddRequestHeader=X-Gateway-Request, true
          order: 50
            
        # ===================================================================================
        # USER-SERVICE SWAGGER ENDPOINTS - Order 100
        # Individual Swagger documentation for User Management Service
        # Accessible at: http://localhost:8080/api/user/swagger-ui.html
        # ===================================================================================
        - id: user-service-swagger-ui
          uri: ${USER_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/user/swagger-ui.html
          filters:
            - SetPath=/swagger-ui.html
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: user-service-swagger-resources
          uri: ${USER_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/user/swagger-ui/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: user-service-webjars
          uri: ${USER_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/user/webjars/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: user-service-api-docs
          uri: ${USER_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/user/v3/api-docs/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        # ===================================================================================
        # NOTIFICATION-SERVICE SWAGGER ENDPOINTS - Order 100
        # Individual Swagger documentation for Notification Service
        # Accessible at: http://localhost:8080/api/notification/swagger-ui.html
        # ===================================================================================
        - id: notification-service-swagger-ui
          uri: ${NOTIFICATION_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/notification/swagger-ui.html
          filters:
            - SetPath=/swagger-ui.html
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: notification-service-swagger-resources
          uri: ${NOTIFICATION_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/notification/swagger-ui/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: notification-service-webjars
          uri: ${NOTIFICATION_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/notification/webjars/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: notification-service-api-docs
          uri: ${NOTIFICATION_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/notification/v3/api-docs/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        # ===================================================================================
        # WARRANTY-SERVICE SWAGGER ENDPOINTS - Order 100
        # Individual Swagger documentation for Warranty Service
        # Accessible at: http://localhost:8080/api/warranty/swagger-ui.html
        # ===================================================================================
        - id: warranty-service-swagger-ui
          uri: ${WARRANTY_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/warranty/swagger-ui.html
          filters:
            - SetPath=/swagger-ui.html
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: warranty-service-swagger-resources
          uri: ${WARRANTY_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/warranty/swagger-ui/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: warranty-service-webjars
          uri: ${WARRANTY_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/warranty/webjars/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: warranty-service-api-docs
          uri: ${WARRANTY_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/warranty/v3/api-docs/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        # ===================================================================================
        # BLOG-SERVICE SWAGGER ENDPOINTS - Order 100
        # Individual Swagger documentation for Blog Service
        # Accessible at: http://localhost:8080/api/blog/swagger-ui.html
        # ===================================================================================
        - id: blog-service-swagger-ui
          uri: ${BLOG_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/blog/swagger-ui.html
          filters:
            - SetPath=/swagger-ui.html
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: blog-service-swagger-resources
          uri: ${BLOG_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/blog/swagger-ui/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: blog-service-webjars
          uri: ${BLOG_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/blog/webjars/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: blog-service-api-docs
          uri: ${BLOG_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/blog/v3/api-docs/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        # ===================================================================================
        # PRODUCT-SERVICE SWAGGER ENDPOINTS - Order 100
        # Individual Swagger documentation for Product Service
        # Accessible at: http://localhost:8080/api/product/swagger-ui.html
        # ===================================================================================
        - id: product-service-swagger-ui
          uri: ${PRODUCT_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/product/swagger-ui.html
          filters:
            - SetPath=/swagger-ui.html
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: product-service-swagger-resources
          uri: ${PRODUCT_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/product/swagger-ui/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: product-service-webjars
          uri: ${PRODUCT_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/product/webjars/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        - id: product-service-api-docs
          uri: ${PRODUCT_SERVICE_URI}
          order: 100
          predicates:
            - Path=/api/product/v3/api-docs/**
          filters:
            - StripPrefix=2
            - AddRequestHeader=X-Gateway-Request, true
            
        # ===================================================================================
        # BUSINESS API ROUTES - Order 200 (Lower Priority)
        # Main business logic endpoints for all microservices
        # Security: All routes require X-Gateway-Request header for service access control
        # URL Pattern: /api/{service}/** → StripPrefix=1 → /{service}/**
        # ===================================================================================
        
        # Auth Service API Routes
        - id: auth-service-direct
          uri: ${AUTH_SERVICE_URI}
          predicates:
            - Path=/auth/**                    # Direct access without /api prefix
          filters:
            - StripPrefix=1                    # /auth/** → /**
            - AddRequestHeader=X-Gateway-Request, true
          order: 200
            
        - id: auth-service-options
          uri: ${AUTH_SERVICE_URI}
          predicates:
            - Path=/api/auth/**               # CORS preflight pattern  
            - Method=OPTIONS
          filters:
            - StripPrefix=1                   # /api/auth/** → /auth/**
            - AddRequestHeader=X-Gateway-Request, true
          order: 150                          # Higher priority than main route
            
        - id: auth-service
          uri: ${AUTH_SERVICE_URI}
          predicates:
            - Path=/api/auth/**               # Standard API pattern
          filters:
            - StripPrefix=1                   # /api/auth/** → /auth/**
            - AddRequestHeader=X-Gateway-Request, true
          order: 200

        # User Management Service API Routes
        - id: user-service
          uri: ${USER_SERVICE_URI}
          order: 200
          predicates:
            - Path=/api/user/**               # Customer & Reseller management
          filters:
            - StripPrefix=1                   # /api/user/** → /user/**
            - AddRequestHeader=X-Gateway-Request, true

        # Notification Service API Routes
        - id: notification-service
          uri: ${NOTIFICATION_SERVICE_URI}
          order: 200
          predicates:
            - Path=/api/notification/**       # Email notifications via Kafka
          filters:
            - StripPrefix=1                   # /api/notification/** → /notification/**
            - AddRequestHeader=X-Gateway-Request, true

        # Blog Service API Routes (CMS)
        - id: blog-service
          uri: ${BLOG_SERVICE_URI}
          order: 200
          predicates:
            - Path=/api/blog/**               # Blog posts, categories, comments
          filters:
            - StripPrefix=1                   # /api/blog/** → /blog/**
            - AddRequestHeader=X-Gateway-Request, true

        # Warranty Service API Routes
        - id: warranty-service
          uri: ${WARRANTY_SERVICE_URI}
          order: 200
          predicates:
            - Path=/api/warranty/**           # Warranty tracking & claims
          filters:
            - StripPrefix=1                   # /api/warranty/** → /warranty/**
            - AddRequestHeader=X-Gateway-Request, true

        # Product Service API Routes
        - id: product-service
          uri: ${PRODUCT_SERVICE_URI}
          order: 200
          predicates:
            - Path=/api/product/**            # Product catalog & management
          filters:
            - StripPrefix=1                   # /api/product/** → /product/**
            - AddRequestHeader=X-Gateway-Request, true

      # ===================================================================================
      # GLOBAL CONFIGURATIONS
      # ===================================================================================
      globals:
        # CORS Configuration - Cross-Origin Resource Sharing
        # Allows frontend applications to access the API Gateway from different domains
        corsConfigurations:
          '[/**]':
            allowedOrigins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:9000,http://localhost:5173}
            allowedOriginPatterns: "*"
            allowedMethods: ${CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,OPTIONS}
            allowedHeaders: ${CORS_ALLOWED_HEADERS:Content-Type,Authorization,X-Requested-With,Accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers}
            allowCredentials: ${CORS_ALLOW_CREDENTIALS:true}

# ===================================================================================
# SPRINGDOC OPENAPI CONFIGURATION
# Centralized Swagger UI configuration aggregating all microservices documentation
# Main Hub: http://localhost:8080/swagger-ui.html
# ===================================================================================
springdoc:
  swagger-ui:
    enabled: ${SWAGGER_UI_ENABLED:true}
    path: /swagger-ui.html
    config-url: /v3/api-docs/swagger-config
    urls:
      - url: /api/auth/v3/api-docs
        name: auth-service
        display-name: "🔐 Authentication Service"
      - url: /api/user/v3/api-docs
        name: user-service
        display-name: "👤 User Management Service"
      - url: /api/blog/v3/api-docs
        name: blog-service
        display-name: "📝 Blog Service"
      - url: /api/product/v3/api-docs
        name: product-service
        display-name: "🛍️ Product Service"
      - url: /api/notification/v3/api-docs
        name: notification-service
        display-name: "📬 Notification Service"
      - url: /api/warranty/v3/api-docs
        name: warranty-service
        display-name: "🛡️ Warranty Service"
  api-docs:
    enabled: ${SWAGGER_API_DOCS_ENABLED:true}